<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
        /* Для игры бродилка, добавить возможность ходить по диагонали цифрами 
        1, 3, 7, 9. Также необходимо сделать так, чтобы пользователь не мог 
        совершить шаг в стенку, т.е. при направлении в стенку и игрок оставался 
        на том же месте где стоял. */

        "use strict";
        //------------------ config ----------------------------------
        const config = {
            rowsCount: 12,
            colsCount: 10,
        };
        //------------------ player ----------------------------------
        const player = {
            x: 0,
            y: 0,

            /* Двигает игрока по переданному направлению.
             * @param {{x: int, y: int}} nextPoint Следующая точка пользователя.
             */
            move(nextPoint) {
                this.x = nextPoint.x;
                this.y = nextPoint.y;
            },
        };
        //--------------- renderer ----------------------------------
        let renderer = {
            // Сюда запишем все что надо отобразить.
            map: "",

            /* Отображает игру в консоли. */
            render() {
                // Цикл перебирает все строки, которые надо отобразить.
                for (let row = 0; row < config.rowsCount; row++) {
                    // В каждой строке отображаем для каждой колонки (x - клетка, o - игрок).
                    for (let col = 0; col < config.colsCount; col++) {
                        // Проверяем, если на данной позиции должен быть и игрок, отображаем игрока, если нет - клетку.
                        if (player.y === row && player.x === col) {
                            this.map += 'o ';
                        } else {
                            this.map += 'x ';
                        }
                    }
                    // После того как отобразили всю строку делаем переход на следующую строку.
                    this.map += '\n';
                }
                
                // Выводим все что надо отобразить в игре.
                console.log(this.map);
            },

            clear() {
                // Чистим консоль.
                console.clear();
                // Чистим карту.
                this.map = "";
            }
        };
        //--------------- mover ----------------------------------
        let mover = {
            /* Получает и отдает направление от пользователя.
             * @returns {int} Возвращаем направление, введенное пользователем.
             */
            getDirection() {
                // Доступные значения ввода.
                const availableDirections = [1, 2, 3, 4, 6, 7, 8, 9];

                while (true) {
                    // Получаем от пользователя направление.
                    let direction = parseInt(prompt('Введите число 1, 2, 3, 4, 6, 7, 8, 9, куда вы хотите переместиться, "Отмена" для выхода.'));
                    if (isNaN(direction)) {
                        return null;
                    }
                    // Если направление не одно из доступных, то сообщаем что надо ввести корректные данные
                    // и начинаем новую итерацию.
                    if (!availableDirections.includes(direction)) {
                        alert('Для перемещения необходимо ввести одно из чисел 1, 2, 3, 4, 6, 7, 8, 9.');
                        continue;
                    }

                    // Если пользователь ввел корректное значение - отдаем его.
                    return direction;
                }
            },

            /* Отдает следующую точку в которой будет находиться пользователь после движения.
             * @param {int} direction Направление движения игрока.
             * @returns {{x: int, y: int}} Следующая позиция игрока.
             */
            getNextPosition(direction) {
                // Следующая точка игрока, в самом начале в точке будут текущие координаты игрока.
                const nextPosition = {
                    x: player.x,
                    y: player.y,
                };
                // Определяем направление и обновляем местоположение игрока в зависимости от направления.
                switch (direction) {
                    case 1:
                        if (nextPosition.y < config.rowsCount - 1 && nextPosition.x > 0){
                            nextPosition.y++;
                            nextPosition.x--;
                        };
                        break;
                    case 2:
                        if (nextPosition.y < config.rowsCount - 1){
                            nextPosition.y++;
                        };
                        break;
                    case 3:
                        if (nextPosition.y < config.rowsCount - 1 && nextPosition.x < config.colsCount - 1){
                            nextPosition.y++;
                            nextPosition.x++;
                        };
                        break;
                    case 4:
                        if (nextPosition.x > 0){
                            nextPosition.x--;
                        };
                        break;
                    case 7:
                        if (nextPosition.y > 0 && nextPosition.x > 0){
                            nextPosition.y--;
                            nextPosition.x--;
                        };
                        break;
                    case 6:
                        if (nextPosition.x < config.colsCount - 1){
                            nextPosition.x++;
                        };
                        break;
                    case 8:
                        if (nextPosition.y > 0){
                            nextPosition.y--;
                        };
                        break;
                    case 9:
                        if (nextPosition.y > 0 && nextPosition.x < config.colsCount - 1){
                            nextPosition.y--;
                            nextPosition.x++;
                        };
                        break;
                };
                return nextPosition;
            },
        };
        //------------------------------ GAME --------------------------------
        let game = {
            /* Запускает игру. */
            run() {
                // Бесконечный цикл
                while (true) {
                    // Получаем направление от игрока.
                    const direction = mover.getDirection();

                    // Если игрок сказал что хочет выйти, то игра заканчивается.
                    if (direction === null) {
                        console.log("Игра окончена.");
                        return;
                    }
                    // Получаем следующую точку пользователя в зависимости от направления.
                    const nextPoint = mover.getNextPosition(direction);
                    
                    renderer.clear();
                    player.move(nextPoint);
                    renderer.render();
                }
            },

            // Этот метод выполняется при открытии страницы.
            init() {
                console.log("Ваше положение на поле в виде о.");
                // Отображаем нашу игру.
                renderer.render();
                console.log("Чтобы начать игру наберите game.run() и нажмите Enter.");
            }
        };

        game.init();
    </script>
</body>
</html>
